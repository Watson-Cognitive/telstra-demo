var Arbiter=function(){var a=function(){var b={},c={},d={},e={},f=1;return{version:"1.0",updated_on:"2011-12-19",create:function(){return a()},subscribe:function(){var a,g,h,i,j,k,l,m,n={},o=!1,p=0,q=[];if(arguments.length<2)return null;g=arguments[0],k=arguments[arguments.length-1],arguments.length>2&&(n=arguments[1]||{}),arguments.length>3&&(l=arguments[2]),n.priority&&(p=n.priority),"string"==typeof g&&(g=g.split(/[,\s]+/));for(var r=0;r<g.length;r++)if(a=g[r],/\*$/.test(a)?(o=!0,a=a.replace(/\*$/,""),(h=c[a])||(c[a]=h=[])):(h=b[a])||(b[a]=h=[]),m=f++,j={id:m,f:k,p:p,self:l,options:n},e[m]=j,h.push(j),h=h.sort(function(a,b){return a.p>b.p?-1:a.p==b.p?0:1}),o?c[a]=h:b[a]=h,q.push(m),!n.persist&&d[a]){i=d[a];for(var s=0;s<i.length;s++)j.f.call(j.self,i[s],{persist:!0})}return g.length>0?q:q[0]},publish:function(a,e,f){var g,h,i,j=10,k=!0,l=!0,m={},n=b[a]||[];f=f||{};for(i in c)0==a.indexOf(i)&&(n=n.concat(c[i]));if(!0===f.persist&&(d[a]||(d[a]=[]),d[a].push(e)),0==n.length)return k;"boolean"==typeof f.cancelable&&(l=f.cancelable);for(var o=0;o<n.length;o++)if(h=n[o],!h.unsubscribed)try{if(!0===f.async||h.options&&h.options.async)setTimeout(function(b){return function(){b.f.call(b.self,e,a,m)}}(h),j++);else if(g=h.f.call(h.self,e,a,m),l&&!1===g)break}catch(a){k=!1}return k},unsubscribe:function(a){return!!e[a]&&(e[a].unsubscribed=!0,!0)},resubscribe:function(a){return!!e[a]&&(e[a].unsubscribed=!1,!0)}}};return a()}(),tcom=tcom||{};tcom.loyaltyAuth=void 0===typeof tcom.loyaltyAuth?tcom.loyaltyAuth:{},tcom.loyaltyAuth={service:{URL:tcom.loyalty.config.baseUrl+"/public/authenticated"},log:function(){"use strict"},baseURL:"https://signon.bigpond.com/login?goto=",url:"https://signon.bigpond.com/login?goto="+tcom.loyalty.config.baseUrl+"/&flp="+window.location},tcom.loyaltyAuth.getQueryVariable=function(a){"use strict";for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]===a)return e[1]}return!1},"true"===tcom.loyaltyAuth.getQueryVariable("debug")&&(tcom.loyaltyAuth.log=function(a){"use strict";window.console.log(a)}),tcom.loyaltyAuth.handleAuth=function(){"use strict";var a={};a.service=function(){var b=new XMLHttpRequest;b.open("GET",tcom.loyaltyAuth.service.URL,!0),b.withCredentials=!0,b.onreadystatechange=function(){a.serviceHandler(b)},b.send()},a.serviceHandler=function(a){console.log(a.status),200===a.status&&4===a.readyState&&(!0===JSON.parse(a.response).loggedIn?Arbiter.publish("authenticated/status",{status:!0,reason:"Passed authentication endpoint check"},{persist:!0}):Arbiter.publish("authenticated/status",{status:!1,reason:"Failed authentication endpoint check"},{persist:!0}))},Arbiter.subscribe("authenticated/status",function(a){tcom.loyaltyAuth.log("Authentication status: "+a.status),tcom.loyaltyAuth.log("Authentication reason: "+a.reason)}),a.service()},tcom.loyaltyAuth.handleAuth();
//# sourceMappingURL=auth.js.map